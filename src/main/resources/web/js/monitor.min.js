function setData(a,t,e){var s=a.indexOf(".");$("#tl").text(a.substring(0,s)),$("#ts").text(a.substring(s,5)+" °C");var r=t.indexOf(".");$("#hl").text(t.substring(0,r)),$("#hs").text(t.substring(r,5)+" %");var d=e.indexOf(".");$("#pl").text(e.substring(0,d)),$("#ps").text(e.substring(d,7)+" hPa")}function updateGraphs(){updateGraph("record"),updateGraph("hour"),updateGraph("day"),updateGraph("month"),updateGraph("year")}function updateGraph(a){getJSON("?type="+a,function(t){var e=charts[a],s=t.format;e.data.datasets[0].data=t.data[0],e.data.datasets[1].data=t.data[1],e.data.datasets[2].data=t.data[2],e.data.labels=[],addLabels(a,s,t.label1,t.label2,e.data.labels),e.update()})}function drawGraphs(){drawGraph("realtime"),drawGraph("record"),drawGraph("hour"),drawGraph("day"),drawGraph("month"),drawGraph("year")}function drawGraph(a){if("realtime"===a){var t=$.extend(!0,{},template);t.data.labels=new Array(61),t.options.animation.duration=0,charts[a]=new Chart($("#graph-realtime"),t)}else getJSON("?type="+a,function(t){var e=$.extend(!0,{},template),s=t.format;e.data.datasets[0].data=t.data[0],e.data.datasets[1].data=t.data[1],e.data.datasets[2].data=t.data[2],addLabels(a,s,t.label1,t.label2,e.data.labels),charts[a]=new Chart($("#graph-"+a),e)})}function addLabels(a,t,e,s,r){for(var d=0;d<e.length;d++){var i=e[d],l=s[d];"record"===a&&0===l&&(l="00"),r.push(t.replace("{{STR1}}",String(i)).replace("{{STR2}}",String(l)))}}function getJSON(a,t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&this.response&&t(this.response)},e.open("GET","api.json"+a,!0),e.responseType="json",e.send(null)}var charts={};drawGraphs(),getJSON("",function(a){setData(a.temp,a.hum,a.pres);var t,e,s=a.port;"monitor.siketyan.me"===location.hostname?(t="wss://",e="/socket"):(t="ws://",e=":"+s+"/");var r=new WebSocket(t+location.hostname+e);r.onmessage=function(a){if("update"===a.data)updateGraphs();else{var t=a.data.split(",");setData(t[0],t[1],t[2]);var e=charts.realtime;e.data.datasets[0].data.push(t[0]),e.data.datasets[1].data.push(t[1]),e.data.datasets[2].data.push(t[2]);var s=e.data.datasets[0].data.length;s>61?(e.data.datasets[0].data.shift(),e.data.datasets[1].data.shift(),e.data.datasets[2].data.shift()):(e.data.labels.unshift(periods[s-1]),e.data.labels.pop()),e.update()}}});var periods=["Now","","","","","","","","","","10s","","","","","","","","","","20s","","","","","","","","","","30s","","","","","","","","","","40s","","","","","","","","","","50s","","","","","","","","","","1m"],template={type:"line",data:{labels:[],datasets:[{borderColor:"rgb(255, 99, 132)",borderWidth:1,data:[],fill:!1,yAxisID:"axis-temp"},{borderColor:"rgb(54, 162, 235)",borderWidth:1,data:[],fill:!1,yAxisID:"axis-hum"},{borderColor:"rgb(255, 205, 86)",borderWidth:1,data:[],fill:!1,yAxisID:"axis-pres"}]},options:{legend:{display:!1},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Temperature (°C)"},type:"linear",display:!0,position:"left",id:"axis-temp"},{scaleLabel:{display:!0,labelString:"Humidity (%)"},type:"linear",display:!0,position:"right",id:"axis-hum"},{scaleLabel:{display:!0,labelString:"Pressure (hPa)"},type:"linear",display:!0,position:"right",id:"axis-pres"}]}}};